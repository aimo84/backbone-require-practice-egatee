!function(e){var t=function(t,r){if(!window.FileReader)return void e.custom.Dialog.Toast("该浏览器暂不支持图片预览，推荐使用chrome浏览器",2);for(var n,a=[],o=0;o<t.length;o++){var i=t[o],s=new FileReader;s.onload=function(e){a.push({name:i.name,uri:e.target.result})},s.onerror=function(){a.push({name:i.name,uri:""})},s.readAsDataURL(i)}n=setInterval(function(){a.length==t.length&&(clearInterval(n),r&&r(a))},30)},r=e.custom.Class({__propertys__:function(){this.formData=null},initialize:function(t){e.extend(this,t)},resetFileElement:function(t){var r=e(t.currentTarget||t);r&&r.length&&(r.wrap("<form></form>"),r.parent()[0].reset(),r.unwrap())},onSubmit:function(t,r){if(this.formData){var n=new XMLHttpRequest;if(t.success&&n.addEventListener("load",function(){if(200===n.status){var e=JSON.parse(n.responseText);t.success(e)}else t.error()},!1),t.error&&(n.addEventListener("error",t.error,!1),n.addEventListener("abort",t.error,!1)),t.progress&&n.upload.addEventListener("progress",function(e){if(e.lengthComputable){var r=Math.round(100*e.loaded/e.total);t.progress(r)}},!1),n.open(this.method,this.url),r)for(var a in r)this.formData.append(a,r[a]);n.send(this.formData)}else e.custom.Dialog.Toast("请选择要上传文件",2),t.Prompt()},onSelected:function(r,n){if(!window.FormData||!window.FileReader)return this.resetFileElement(r),void e.custom.Dialog.Toast("该浏览器暂不支持文件上传，推荐使用chrome浏览器",2);var a=[],o=r.target.files,i=e(r.target).attr("accept"),s=new window.FormData;if(i=i?i.match(/\w+/g).join("|"):"",o&&o.length)for(var l=0;l<o.length;l++){var u=o[l],f=u.name.toLowerCase();if(u.type.match("image.*")&&a.push(u),i){var d=new RegExp("(.*)\\.("+i+")$").test(f);if(!d){e.custom.Dialog.Toast("所选文件类型不支持",2);break}s.append(f,u)}l==o.length-1&&(this.formData=s,a&&a.length?t(a,n):n&&n(f))}else this.formData=null,a&&a.length||n&&n()}}),n={method:"post",url:""};e.custom.Register("Upload",function(t){return new r(e.extend({},n,t))})}(jQuery);