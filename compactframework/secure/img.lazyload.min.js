!function(t){"use strict";var i=function(){var t=100;return{getBiggerEventIndex:function(){return t++}}}(),r=t.custom.Class({__propertys__:function(){this.isError=!1,this.isResizeListener=!1,this.isFilterLoadError=!1},initialize:function(t){this.handleOpts(t),this.init()},handleOpts:function(r){return t.extend(this,r||{}),this.isError=!1,r&&r.imgs&&r.imgs.length?(this.needWrapper=!1,(this.width||this.height)&&(this.needWrapper=!0),this.imgContainer={},void(this.lazyLoadNSName=".imglazyload"+i.getBiggerEventIndex())):void(this.isError=!0)},init:function(){this.isError||(this.initImgContainer(),this.lazyLoad(),this.bindEvents())},refresh:function(t){this.destroy(),t&&this.handleOpts(t),this.init()},bindEvents:function(){var i=this;if(!this.isError){this.destroy();var r=_.throttle(function(){i.lazyLoad()},100);this.container.on("scroll"+this.lazyLoadNSName,r);var n=_.throttle(function(){i.initImgContainer(),i.isResizeListener&&i.lazyLoad()},300);t(window).on("resize"+this.lazyLoadNSName,n)}},initImgContainer:function(){if(!this.isError){var i,r,n,e,a=this.container.offset()||{top:0,left:0};for(r=0,n=this.imgs.length;r<n;r++)if(i=t(this.imgs[r]),i.attr("data-src")&&""!=i.attr("data-src")&&"1"!=i.attr("data-load")&&(!this.isFilterLoadError||"2"!=i.attr("data-load"))){e=i.offset();var s=e.top-a.top;this.imgContainer[s]||(this.imgContainer[s]=[]),this.imgContainer[s].push(i)}}},_handleImg:function(i){var r,n,e,a;if(i.attr("data-src")&&""!=i.attr("data-src")){this.needWrapper&&(n=t(this.wrapper),n.css({width:this.width+"px",height:this.height+"px","background-color":this.loadingBg}),n.insertBefore(i),n.append(i)),r=t(new Image),e=i.attr("data-width"),a=i.attr("data-height"),i.attr("src")||i.attr("src",this.loadingImg);var s=this.errorImg;r.on("error",function(){e&&i.css("width",e),a&&i.css("height",a),i.attr("src",s),i.attr("data-load","2")}).on("load",function(){e&&i.css("width",e),a&&i.css("height",a),i.attr("src",i.attr("data-src")),i.attr("data-load","1"),setTimeout(function(){n&&n[0]&&(i.insertBefore(n),n.remove())},1)}).attr("src",i.attr("data-src"))}},lazyLoad:function(){if(!this.isError){var i,r,n,e,a,s=this.container.height(),o=this.container.scrollTop();for(i in this.imgContainer)if(parseInt(i)<o+s){for(r=this.imgContainer[i],e=0,a=r.length;e<a;e++)n=t(r[e]),this._handleImg(n);delete this.imgContainer[i]}}},destroy:function(){this.isError||(this.container.off(this.lazyLoadNSName),t(window).off(this.lazyLoadNSName))}}),n={imgs:[],container:t(window),width:0,height:0,isResizeListener:function(){},isFilterLoadError:function(){},loadingImg:"",loadingBg:"#ebebeb",errorImg:"",wrapper:'<div class="cui_lazyload_wrapper" style="text-align: center; vertical-align: middle; "></div>'};t.custom.Register("ImgLazyload",function(i){return new r(t.extend({},i,n))})}(jQuery);